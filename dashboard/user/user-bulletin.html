<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C.A.P.T. User Dashboard</title>
  <link rel="stylesheet" href="user-bulletin.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header class = "header-div">

    <div class = "header-web">
      <div class = "logo-greeting-div">
        <div class = "img-logo-div">
        <img src = "/Resources/logos/logo-white-short.png" class = "img-logo">
        </div>
        <h1 class = "greeting-web" id="welcome">Welcome, (Name)!</h1>

        <script>
          fetch('/dashboard/user/user-getdata.php')
            .then(res => res.json())
            .then(data => {
              document.getElementById('welcome').textContent =
                `Welcome, Capt. ${data.name}!`;
            })
            .catch(err => console.error('Error fetching user data:', err));
        </script>
      </div>
      <div class = "navigation-div">
        <button class = "navigation-btn"  onclick="window.location.href='/dashboard/user/user-bulletin.html'" >Bulletin</button>
        <button class = "navigation-btn" onclick="window.location.href='/dashboard/user/user-request.html'" >Request</button>
        <button class = "navigation-btn" onclick="window.location.href='/dashboard/user/user-template.html'" >Manage</button>
      </div>
        <button class = "profile-btn">
          <img src="/Resources/icons/person-icon.png" class="profile-img" alt="Settings">
        </button>
    </div>

    <div class = "header-mobile">
      <button class = "menu-btn">â˜°</button>
      <div class = "logo-title-div">
        <div class = "img-logo-div-mobile">
        <img src = "/Resources/logos/logo-white-short.png" class = "img-logo-mobile">
        </div>
        <h1 class = "greeting-mobile">C.A.P.T.</h1>
      </div>
    </div>
  </header>

  <div class = "option-panel">
    <button class = "announcements-btn">Announcements</button>
    <button class = "events-btn">Events</button>
  </div>

  <div class = "main-body">
    <div class = "announcements">
      <H1 class = "announcements-title">Announcements</H1>
      <div class = "post-feed" id="announcements-feed">
        <p>Loading announcements...</p>
      </div>
    </div>

    <div class="events">
      <H1 class="events-title">Events</H1>
      <div class="post-feed" id="events-feed">
        <p>Loading events...</p>
      </div>
    </div>
  </div>

  <div class ="sidebar">
    <div class = "sidebar-topbar">
      <h1 class = "sidebar-title">Navigation</h1>
      <button class = "close-btn">X</button>
    </div>
    <a class="navigation-btn-side" href="/dashboard/user/user-bulletin.html">Bulletin</a>
    <a class="navigation-btn-side" href="/dashboard/user/user-request.html">Request</a>
    <a class="navigation-btn-side" href="/dashboard/user/user-template.html">Manage</a>
    <a class="navigation-btn-side" href="/dashboard/user/user-profile.html">Profile</a>
  </div>

  <script>
    const menuBtn = document.querySelector('.menu-btn');
    const closeBtn = document.querySelector('.close-btn');
    const sidebar = document.querySelector('.sidebar');

    // Show sidebar when menu button is clicked
    menuBtn.addEventListener('click', () => {
      sidebar.classList.add('active');
    });

    closeBtn.addEventListener('click', () => {
      sidebar.classList.remove('active');
    });
  </script>

  <script>
    const announcementsBtn = document.querySelector('.announcements-btn');
    const eventsBtn = document.querySelector('.events-btn');
    const announcements = document.querySelector('.announcements');
    const events = document.querySelector('.events');

    // Track which pane is selected on mobile.
    let activePane = 'announcements'; // or read from DOM on load

    const mql = window.matchMedia('(max-width: 900px)');

    function applyLayout() {
      if (mql.matches) {
        // Mobile: show only the active pane
        const showAnnouncements = activePane === 'announcements';

        announcements.classList.toggle('active', showAnnouncements);
        events.classList.toggle('active', !showAnnouncements);

        announcementsBtn.classList.toggle('active', showAnnouncements);
        eventsBtn.classList.toggle('active', !showAnnouncements);

        // Enable only the non-active button so tapping switches panes
        announcementsBtn.disabled = showAnnouncements;
        eventsBtn.disabled = !showAnnouncements;
      } else {
        // Desktop: show both, both enabled, no "active" highlight on buttons
        announcements.classList.add('active');
        events.classList.add('active');

        announcementsBtn.disabled = false;
        eventsBtn.disabled = false;

        announcementsBtn.classList.remove('active');
        eventsBtn.classList.remove('active');
      }
    }

    // Button handlers just update state, then apply layout
    announcementsBtn.addEventListener('click', () => {
      if (!mql.matches) return;
      activePane = 'announcements';
      applyLayout();
    });

    eventsBtn.addEventListener('click', () => {
      if (!mql.matches) return;
      activePane = 'events';
      applyLayout();
    });

    // Run once on load
    applyLayout();

    // Only react when crossing the breakpoint
    mql.addEventListener?.('change', applyLayout);

    // (Optional) Debounce raw resize as a fallback for older browsers
    let t;
    window.addEventListener('resize', () => {
      clearTimeout(t);
      t = setTimeout(applyLayout, 150);
    });
  </script>

  <!-- ADD: script to load announcements and events -->
   <script>
    document.addEventListener("DOMContentLoaded", () => {
      const announcementsFeed = document.getElementById("announcements-feed");
      const eventsFeed = document.getElementById("events-feed");

      fetch("/dashboard/admin/bulletin-pages/get-announcements.php")
        .then(res => res.json())
        .then(data => {
          announcementsFeed.innerHTML = "";
          if (data.length === 0) {
            announcementsFeed.innerHTML = "<p>No announcements found.</p>";
            return;
          }

          data.forEach(announcement => {
            const post = document.createElement('div');
            post.classList.add('posts');
            post.innerHTML = `
              <h3 class = "post-date">Date Posted: ${announcement.timeCreated}</h3>
              <h2 class = "post-title">${announcement.title}</h2>
              <h3 class = "post-caption">${announcement.caption}</h3>
              <img class = "post-img" src = "${announcement.image}" alt="Announcement image">
            `;
            announcementsFeed.appendChild(post);
          });
        })
        .catch(() => announcementsFeed.innerHTML = "<p>Failed to load announcements.</p>");

      fetch("/dashboard/admin/bulletin-pages/get-events.php")
        .then(res => res.json())
        .then(data => {
          eventsFeed.innerHTML = "";
          if (data.length === 0) {
            eventsFeed.innerHTML = "<p>No events found.</p>";
            return;
          }

          data.forEach(event => {
            const post = document.createElement('div');
            post.classList.add('posts');
            post.innerHTML = `
                <h3 class = "post-date">Date Posted: ${event.timeCreated}</h3>
                <h2 class = "post-title">${event.title}</h2>
                <h3 class = "post-caption">${event.caption}</h3>
                <img class = "post-img" src = "${event.image}" alt="Event image">
              `;
            eventsFeed.appendChild(post);
          });
        })
        .catch(() => eventsFeed.innerHTML = "<p>Failed to load events.</p>");
    });
   </script>
  
</body>
</html>